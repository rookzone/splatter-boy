# === Project Settings ===
PROJECT_NAME = splatter-boy
SRC_DIR = src
BUILD_DIR = build
BIN_DIR = bin

# === Compiler Settings ===
CC = lcc

# === Source Files ===
SRC = $(wildcard $(SRC_DIR)/*.c) \
	$(wildcard $(SRC_DIR)/tiles/*.c) \
	$(wildcard $(SRC_DIR)/maps/*.c) \
	$(wildcard $(SRC_DIR)/states/*.c)

# === Output ===
OBJ = $(patsubst $(SRC_DIR)/%.c,$(BUILD_DIR)/%.o,$(SRC))
OUT = $(BUILD_DIR)/$(PROJECT_NAME).gb

# === Compiler Flags ===
CFLAGS = -Wa-l -Wl-m -Wl-j -Iinclude

# === Default Rule ===
all: $(OUT)
	@echo "Build complete: $(OUT)"

# NEW LINK RULE:
# This .PHONY rule forces the linker to run every time, fixing the header dependency problem.
.PHONY: $(OUT)
$(OUT): $(SRC) $(wildcard include/*.h)
	@mkdir -p $(BUILD_DIR)
	@mkdir -p $(BIN_DIR)
	$(CC) $(CFLAGS) -o $(OUT) $(SRC)

# === Clean rule ===
clean:
	@echo "Cleaning build files..."
	@rm -rf $(BUILD_DIR) $(BIN_DIR)
	@echo "Done."

# === Rebuild rule ===
rebuild: clean all